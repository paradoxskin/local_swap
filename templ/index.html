<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width" />
		<title>SwmmwAP</title>
		<style type="text/css">
			@font-face {
				font-family: pico;
				src:url("font/pico-8.ttf")
			}
			.picow {
				font-family: pico;
				-webkit-text-stroke: 1px #000;
				color: #fff;
			}
			.picob {
				font-family: pico;
				-webkit-text-stroke: 1px #fff;
				color: #000;
			}
		</style>
	</head>
	<body class="bg-success">
		<span id="wait" style="display:none;">
			<div class="position-fixed top-0 start-0 w-100 h-100 bg-dark bg-opacity-75 d-flex justify-content-center align-items-center text-white fs-1 fw-bold picow" style="z-index:1050;">u wait...</div>
		</span>
		<span id="write" style="display:none;">
			<div class="position-fixed top-0 start-0 w-100 h-100 d-flex flex-column justify-content-center align-items-center bg-dark bg-opacity-75 text-white" style="z-index:1050;">
				<button id="closeTextModal" type="button" class="btn-close btn-close-white mb-3"></button>
				<textarea id="textInput" class="form-control bg-secondary w-75" rows="1" placeholder="WT IT"></textarea>
				<button id="submitText" type="button" class="btn btn-dark w-75"><span class="picow">ok</span></button>
			</div>
		</span>
		<div class="fixed-top btn btn-success" id="flash">
			<div class="picow h2"><span id="pre"></span><span class="picob" id="url"></span></div>
		</div>
		<div class="btn btn-success">
			<div class="picob h2">.</div>
		</div>

		<div class="" id="file_list">
		</div>

		<textarea id="copy" style="display: none;"></textarea>
		<div class="" id="text_list">
		</div>

		<input type="file" id="select" style="display: none;" multiple>
		<div class="fixed-bottom btn btn-dark" id="upload">
			<div class="picow h1">up!</div>
		</div>
		<div class="fixed-bottom" id="multi" style="display: none;">
			<div class="btn btn-dark w-25" id="text">
				<div class="picow h1">t</div>
			</div>
			<div class="btn btn-dark w-50" id="file">
				<div class="picow h1">file</div>
			</div>
			<div class="btn btn-dark w-auto" id="delete">
				<div class="picow h1">d</div>
			</div>
			<div class="btn btn-dark float-end" id="back">
				<div class="picow h1">x</div>
			</div>
		</div>
	</body>
</html>
<link rel="stylesheet" href="/css/bootstrap.min.css">
<script src="/js/jquery-3.6.3.min.js"></script>
<script src="/js/bootstrap.min.js"></script>
<script charset="utf-8">
	$("#flash").click(function() {
		location.reload();
	});
	$("#upload").click(function() {
		$("#upload").hide();
		$("#multi").show();
	});
	$("#back").click(function() {
		$("#multi").hide();
		$("#upload").show();
	});
	$("#file").click(function() {
		$("#select").click();
	});
	$("#delete").click(function() {
		$.get("/cleanit", function() {
			location.reload();
		});
	});
	$("#select").change(function() {
		var files = document.getElementById("select").files;
		var fin = 0;
		$("#wait")[0].style.display="flex";
		for (let i = 0; i < files.length; i++) {
			var formData = new FormData();
			formData.append("file", files[i]);
			$.ajax({
				url: "/upload",
				data: formData,
				processData: false,
				contentType: false,
				type: "POST",
				success: function(data) {
					$("#file_list").prepend("<div class=\"h2\"> <img src=\"/svg/gift.svg\" alt=\"Bootstrap\" width=\"32\" height=\"32\"> <span class=\"picob\">"+data.filename+"</span> <a target=\"blank\" href=\"/files/"+data.filename+"\" download=\""+data.filename+"\" class=\"btn btn-light w-25 float-end\"><span class=\"picow\">down</span></a> </div>");
				},
				complete: function() {
					fin++;
					if (fin == files.length) {
						$("#wait")[0].style.display="none";
					}
				}
			});
		}
	});
	$("#closeTextModal").click(function() {
		$("#write")[0].style.display = "none";
		$("#textInput")[0].value = "";
	});
	$("#submitText").click(function() {
		var text = $("#textInput")[0].value;
		if(text == "" || text == null){
			$("#closeTextModal")[0].click()
			return;
		}
		$.post(
			"/text",
			{"text": text}
		);
		text_list.push(text);
		$("#text_list").prepend("<div class=\"h2\"> <img src=\"/svg/text.svg\" alt=\"Bootstrap\" width=\"32\" height=\"32\"> <span class=\"picow\">"+text.substr(0, 10)+"</span> <span class=\"btn btn-dark w-25 float-end\" id=\""+"t_"+(text_list.length-1)+"\"><span class=\"picob\">copy</span></span> </div>");
		$("#t_"+(text_list.length - 1)).click(function(){
			$("#copy").text(text_list[this.id.substr(2)]).show();
			document.getElementById("copy").select();
			document.execCommand("copy", false, null);
			$("#copy").hide();
		});
		$("#closeTextModal")[0].click()
	});
	$("#text").click(function() {
		$("#write")[0].style.display = "flex";
	});
	var text_list = [];
	$.post(
		"/",
		function(data) {
			console.log(data);
			if(data.ip != ":(") {
				$("#url").text(data.ip);
				$("#pre").text("se|");
			}
			if(data.files != null){
				for(var i = 0; i < data.files.length; i++) {
					$("#file_list").prepend("<div class=\"h2\"> <img src=\"/svg/gift.svg\" alt=\"Bootstrap\" width=\"32\" height=\"32\"> <span class=\"picob\">"+data.files[i]+"</span> <a target=\"blank\" href=\"/files/"+data.files[i]+"\" download=\""+data.files[i]+"\" class=\"btn btn-light w-25 float-end\"><span class=\"picow\">down</span></a> </div>");
				}
			}
			if(data.texts != null){
				for(var i = 0; i < data.texts.length; i++) {
					text_list.push(data.texts[i]);
					$("#text_list").prepend("<div class=\"h2\"> <img src=\"/svg/text.svg\" alt=\"Bootstrap\" width=\"32\" height=\"32\"> <span class=\"picow\">"+data.texts[i].substr(0, 10)+"..</span> <span class=\"btn btn-dark w-25 float-end\" id=\""+"t_"+i+"\"><span class=\"picob\">copy</span></span> </div>");
					$("#t_"+i).click(function(){
						$("#copy").text(text_list[this.id.substr(2)]).show();
						document.getElementById("copy").select();
						document.execCommand("copy", false, null);
						$("#copy").hide();
					});
				}
			}
			$("#text_list").append("<div class=\"h2\"> <img src=\"/svg/text.svg\" alt=\"Bootstrap\" width=\"32\" height=\"32\"> <span class=\"picow\">BOTTOM</span></div>");
		}
	);
</script>
